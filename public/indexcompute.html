<!DOCTYPE html>
<!--
  ~ /* ------------------------------------------------------------------------------------
  ~  * Copyright (c) SAS Institute Inc.
  ~  *  Licensed under the Apache License, Version 2.0 (the "License");
  ~  * you may not use this file except in compliance with the License.
  ~  * You may obtain a copy of the License at
  ~  *
  ~  * http://www.apache.org/licenses/LICENSE-2.0
  ~  *
  ~  *  Unless required by applicable law or agreed to in writing, software
  ~  * distributed under the License is distributed on an "AS IS" BASIS,
  ~  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  * See the License for the specific language governing permissions and
  ~ * limitations under the License.
  ~ ----------------------------------------------------------------------------------------*/
  ~
  -->

<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<!-- the script below  returns useful information from server in a javascript object name LOGONPAYLOAD -->
		<!-- The most useful element is LOGONPAYLOAD.host , the url of the Viya server -->
		<!-- This helps avoid hard codung the Viya host url in the html -->

		<!-- http package to make calls to Viya -->
    <head>
      <meta charset="UTF-8" />
      <script src="https://unpkg.com/@sassoftware/restaf@test"></script>
      <script src="https://unpkg.com/@sassoftware/restaflib@test"></script>
      <script src="https://unpkg.com/@sassoftware/restafedit@test"></script>

      <!-- editor.js has relevant javascript files-->
      <script src="./lib/computeControl.js"></script>
      <script src="./lib/editor.js"> </script>
  
      <script src="/editorapp/appenv"></script>

      <style>
        .container {
          display: flex;
          flex-direction: column;
          flex-wrap: nowrap;
          min-height: 800px;
        }
        .elabel {
          display: inline-block;
  
          clear: left;
          width: 250px;
          text-align: right;
        }
        .einput {
          display: inline-block;
        }
        .edisabled {
          display: inline-block;
          background: gray;
          color: white;
        }
        .eresult {
          display: inline-block;
          background: cyan;
          color: black;
          font-style: bold;
        }
        .div1 {
          border: 1px solid black;
          background: lightskyblue;
        }
        .div2 {
          border: 1px solid black;
          background: lightskyblue;
          height: 200px;
        }
        .button {
          background: rgba(39, 199, 191, 0.953);
          color: black;
        }
      </style>
      </head>
      <script>
        let appEnv = {};
        let currentRow = {};
      
        // Set values in the field from appEnv.state
        function displayValues() {
          currentRow = appEnv.state.data[0];
          for (let k in currentRow) {
            if (k !== '_rowIndex') {
               document.getElementById(k).value = currentRow[k];
            }
          }
          document.getElementById('status').innerHTML = 'Ready';
          
          showODS()
            .then (r => {
              document.getElementById('ODS').innerHTML = r;
            } )
            .catch(err => console.log(err));

        }

        
        // setup viya connection and read in the first set of records
        function setup() {
          initialize() 
            .then (r => {
              appEnv = r;
              
             
              displayValues();
            })
            .catch (err => {
              console.log(err)
            })

        }
        // handle scrolling
        function scrollTable(direction) {
          document.getElementById('status').innerHTML = 'Reading data...';
          restafedit.scrollTable(direction, appEnv)
            .then ( r => {
              displayValues();
            })
            .catch( err => alert(JSON.stringify(err, null,4)))
        }

        // handle keyboard events
        // My funky way of handling calculations on enter or on field exit
        function handleEnter(name) {
          let value = document.getElementById(name).value;
         // let value = text2Float(valuec, name);
          
          restafedit.cellEdit(name, value,0, currentRow, appEnv )
          .then ( r => {
            displayValues();
          })
          .catch(err => alert(err));
        }
        //handle edit and save 
        function onblurx(name) {
          let v = document.getElementById(name).value;
          handleEnter(name);
        }
        function search(name) {
          if ( event.keyCode === 13) {
            handleEnter(name);
          }
          
        }

			</script>
	 <body onload="setup()">
    <h1> Example of editing SAS Tables Using @sassoftware/restafedit</h1>
      <button  onclick="scrollTable('prev')"> Prev</button>
      <button  onclick="scrollTable('next')"> Next</button>
      <br/>
      <p id="status"> Initializing Compute Session and Sample Data </p>
      <form action="">
        <label class="elabel"> _index_: </label>
          <input class="edisabled" type="input"  disabled id="_index_" size="50" />
          <br />
          <br/>
        <label class="elabel"> id: </label>
          <input class="edisabled" type="input"  disabled id="id" size="50" />
          <br />
          <br/>
  
        <label class="elabel"> x1: </label>
          <input class="einput" type="text" onblur="onblurx('x1')" onkeypress="search('x1')" id="x1" size="50" />
          <br />
  
          <label class="elabel"> x2: </label>
          <input class="einput" type="text" onblur="onblurx('x2')" onkeypress="search('x2')" id="x2" size="50" />
          <br />

          <label class="elabel"> x3: </label>
          <input class="einput" type="text" onblur="onblurx('x3')" onkeypress="search('x3')" id="x3" size="50" />
          <br />
          <br/>

          <label class="elabel"> Grand Total: </label>
          <input class="eresult" type="input" id="total" disabled size="50" />



      </form>
      <br/>
      <br/>
      <div id="ODS"></div>

	</body>
</html>

