<!DOCTYPE html>
<!--
  ~ /* ------------------------------------------------------------------------------------
  ~  * Copyright (c) SAS Institute Inc.
  ~  *  Licensed under the Apache License, Version 2.0 (the "License");
  ~  * you may not use this file except in compliance with the License.
  ~  * You may obtain a copy of the License at
  ~  *
  ~  * http://www.apache.org/licenses/LICENSE-2.0
  ~  *
  ~  *  Unless required by applicable law or agreed to in writing, software
  ~  * distributed under the License is distributed on an "AS IS" BASIS,
  ~  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  * See the License for the specific language governing permissions and
  ~ * limitations under the License.
  ~ ----------------------------------------------------------------------------------------*/
  ~
  -->

<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<!-- the script below  returns useful information from server in a javascript object name LOGONPAYLOAD -->
		<!-- The most useful element is LOGONPAYLOAD.host , the url of the Viya server -->
		<!-- This helps avoid hard codung the Viya host url in the html -->
		<script src="/viyaapp/appenv"></script>

		<!-- http package to make calls to Viya -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js" integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

	
		<script>
			function setup() {
				console.log(LOGONPAYLOAD);  /* for learning purposes */
			}
			function runit(type) {
				document.getElementById('output').innerHTML = '...running';
				let config = {
					url   : `${LOGONPAYLOAD.host}/files/files`,
					method: 'GET',
					withCredentials: true   /* This is required. This allows the browser communicate the credentials to the server */
				}
				axios(config)
					.then (r => {
						console.log(r.data.items);
						let items = r.data.items.map( item => {	return item.id;})
						document.getElementById('output').innerHTML = JSON.stringify(items, null, 4);
					})
					.catch(err => {
						document.getElementById('output').innerHTML = JSON.stringify(err, null, 4);
					})
				
				}
			
		</script>
	</head>
	<body onload="setup()">
		<h1 id="head">Hi</h1>
		<h2> Custom call to Viya Server</h2>
		<div>
			<button onclick="runit()">
				Press to list files from file service
			</button>
			<br />
			<br />
			
		</div>

		<div>
			<h3> List of files</h3>
			<br>
			<pre id="output"></pre>
		</div>
	</body>
</html>
